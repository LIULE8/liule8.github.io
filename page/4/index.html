<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Leo's notes</title><meta name="author" content="Leo Liu"><meta name="copyright" content="Leo Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Leo&#39;s notes">
<meta property="og:url" content="https://liule8.github.io/page/4/index.html">
<meta property="og:site_name" content="Leo&#39;s notes">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://liule8.github.io/images/avatar.png">
<meta property="article:author" content="Leo Liu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://liule8.github.io/images/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://liule8.github.io/page/4/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2021-10-27 11:17:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/images/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">322</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">82</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">46</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Leo's notes</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Leo's notes</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/LIULE8" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:leo.liu.scau@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/2274d1f6.html" title="统一建模语言(UML)">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="统一建模语言(UML)"></a></div><div class="recent-post-info"><a class="article-title" href="/post/2274d1f6.html" title="统一建模语言(UML)">统一建模语言(UML)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-13T14:14:26.074Z" title="发表于 2021-10-13 14:14:26">2021-10-13</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%9E%B6%E6%9E%84/">架构</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/%E6%9E%B6%E6%9E%84/UML/">UML</a></span></div><div class="content">统一建模语言(UML)什么是模型模型是一个系统的完整的抽象。人们对某个领域特定问题的求解及解决方案，对它们的理解和认识都蕴含在模型中。通常，开发一个计算机系统是为了解决某个领域特定问题，问题的求解过程，就是从领域问题到计算机系统的映射。

为什么要建造模型
建造传统模型的目的
为了证明某件事物能否工作
前提：建造模型的成本远远低于建造实物的成本
造飞机
造高楼




建造软件模型的目的
为了与他人沟通
为了保存软件设计的最终成果
前提：除非模型比代码更说明问题



通用模型元素模型元素是UML构造系统的各种元素，是UML构建模型的基本单位。
基元素是由UML定义的模型元素，如：类、结点、构件、注释、关联、依赖和泛化(继承)等
关联关系分类：


泛化(继承) - 类与类，接口与接口的关系
实现 - 是一种类与接口的关系
组合 - 是整体与部分，是“has-a”关系，但部分不能离开整体而单独存在
公司和部门是整体和部分的关系，没有公司就不存在部门
也是一种关联关系，比聚合更强关联


聚合 - 是整体与部分，是“contains-a”关系，且部分可以离开整体而单独存在
车和轮胎是整体 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/7568521a.html" title="Java并发编程(一)">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java并发编程(一)"></a></div><div class="recent-post-info"><a class="article-title" href="/post/7568521a.html" title="Java并发编程(一)">Java并发编程(一)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-12T20:56:27.000Z" title="发表于 2021-10-12 20:56:27">2021-10-12</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Java/">Java</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a></span></div><div class="content">Java并发编程(一)多线程基础为什么会有多线程本质原因是摩尔定律失效 -&gt; 多核+分布式 时代的来临。 JVM、NIO 是不是都因为这个问题变复杂？ 后面讲的分布式系统，也是这个原因
多 CPU 核心意味着同时操作系统有更多的并行计算资源可以使用。 操作系统以线程作为基本的调度单元。
单线程是最好处理不过的。 线程越多，管理复杂度越高。
跟我们程序员都喜欢自己单干一样。 《人月神话》里说加人可能干得更慢。 可见多核时代的编程更有挑战。

SMP架构和NUMA架构SMP架构是对称内存结构，他不是直接跟内存打交道的，中间通过数据总线打交道。
NUMA架构是非一致内存访问架构，将一部分CPU单独跟内存放在一起，好处是CPU可以和自己相邻的内存，如果CPU之间不做数据交互的话，效率会比SMP更高。
Java 线程的创建过程
Java 里线程有三个层次的含义。java 代码层面、JVM 层面、OS 层面
Thread.start() 启动一个线程，Thread 是一个类，它本身跟底层线程没有任何关系。只有它调用了 start() 方法，JVM层面才会创建 JavaThread 对象同时调 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/3d0ce5bf.html" title="Netty 核心原理剖析与 RPC 实践之ByteBuf 与内存管理-Netty 堆外内存">     <img class="post_bg" src="/images/posts/cover/netty.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心原理剖析与 RPC 实践之ByteBuf 与内存管理-Netty 堆外内存"></a></div><div class="recent-post-info"><a class="article-title" href="/post/3d0ce5bf.html" title="Netty 核心原理剖析与 RPC 实践之ByteBuf 与内存管理-Netty 堆外内存">Netty 核心原理剖析与 RPC 实践之ByteBuf 与内存管理-Netty 堆外内存</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-12T20:22:22.000Z" title="发表于 2021-10-12 20:22:22">2021-10-12</time></span></div><div class="content">双刃剑：合理管理 Netty 堆外内存我们需要了解 Java 堆外内存的基本知识，因为当你在使用 Netty 时，需要时刻与堆外内存打交道。我们经常看到各类堆外内存泄漏的排查案例，堆外内存使用不当会使得应用出错、崩溃的概率变大，所以在使用堆外内存时一定要慎重。
为什么需要堆外内存在 Java 中对象都是在堆内分配的，通常我们说的JVM 内存也就指的堆内内存，堆内内存完全被JVM 虚拟机所管理，JVM 有自己的垃圾回收算法，对于使用者来说不必关心对象的内存如何回收。
堆外内存与堆内内存相对应，对于整个机器内存而言，除堆内内存以外部分即为堆外内存，如下图所示。堆外内存不受 JVM 虚拟机管理，直接由操作系统管理。

堆外内存和堆内内存各有利弊，这里我针对其中重要的几点进行说明。

堆内内存由 JVM GC 自动回收内存，降低了 Java 用户的使用心智，但是 GC 是需要时间开销成本的，堆外内存由于不受 JVM 管理，所以在一定程度上可以降低 GC 对应用运行时带来的影响。

堆外内存需要手动释放，这一点跟 C/C++ 很像，稍有不慎就会造成应用程序内存泄漏，当出现内存泄漏问题时排查起来会 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/ffc75501.html" title="Netty 核心原理剖析与 RPC 实践之编解码-数据传输 writeAndFlush">     <img class="post_bg" src="/images/posts/cover/netty.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心原理剖析与 RPC 实践之编解码-数据传输 writeAndFlush"></a></div><div class="recent-post-info"><a class="article-title" href="/post/ffc75501.html" title="Netty 核心原理剖析与 RPC 实践之编解码-数据传输 writeAndFlush">Netty 核心原理剖析与 RPC 实践之编解码-数据传输 writeAndFlush</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-12T19:36:46.000Z" title="发表于 2021-10-12 19:36:46">2021-10-12</time></span></div><div class="content">数据传输：writeAndFlush 处理流程剖析我们介绍了 Netty 编解码的基础知识，想必你已经掌握了 Netty 实现编解码逻辑的技巧。那么接下来我们如何将编解码后的结果发送出去呢？在 Netty 中实现数据发送非常简单，只需要调用 writeAndFlush 方法即可，这么简单的一行代码究竟 Netty 帮我们完成了哪些事情呢？
Pipeline 事件传播回顾在介绍 writeAndFlush 的工作原理之前，我们首先回顾下 Pipeline 的事件传播机制，因为他们是息息相关的。根据网络数据的流向，ChannelPipeline 分为入站 ChannelInboundHandler 和出站 ChannelOutboundHandler 两种处理器，如下图所示。

当我们从客户端向服务端发送请求，或者服务端向客户端响应请求结果都属于出站处理器 ChannelOutboundHandler 的行为，所以当我们调用 writeAndFlush 时，数据一定会在 Pipeline 中进行传播。
在这里我首先抛出几个问题，可以用于检验下自己是否真的理解了 writeAndFlush  ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/19741a1b.html" title="Netty 核心原理剖析与 RPC 实践之编解码-Netty 常用解码器">     <img class="post_bg" src="/images/posts/cover/netty.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心原理剖析与 RPC 实践之编解码-Netty 常用解码器"></a></div><div class="recent-post-info"><a class="article-title" href="/post/19741a1b.html" title="Netty 核心原理剖析与 RPC 实践之编解码-Netty 常用解码器">Netty 核心原理剖析与 RPC 实践之编解码-Netty 常用解码器</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-12T12:44:03.000Z" title="发表于 2021-10-12 12:44:03">2021-10-12</time></span></div><div class="content">开箱即用：Netty 支持哪些常用的解码器？前面我们介绍了 TCP 拆包/粘包的问题，以及如何使用 Netty 实现自定义协议的编解码。可以看到，网络通信的底层实现，Netty 都已经帮我们封装好了，我们只需要扩展 ChannelHandler 实现自定义的编解码逻辑即可。更加人性化的是，Netty 提供了很多开箱即用的解码器，这些解码器基本覆盖了 TCP 拆包/粘包的通用解决方案。我们将对 Netty 常用的解码器进行讲解，一起探索下它们有哪些用法和技巧。
首先回顾一下 TCP 拆包/粘包的主流解决方案。并梳理出 Netty 对应的编码器类。
固定长度解码器 FixedLengthFrameDecoder固定长度解码器 FixedLengthFrameDecoder 非常简单，直接通过构造函数设置固定长度的大小 frameLength，无论接收方一次获取多大的数据，都会严格按照 frameLength 进行解码。如果累积读取到长度大小为 frameLength 的消息，那么解码器认为已经获取到了一个完整的消息。如果消息长度小于 frameLength，FixedLengthFrame ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/cb9ed29c.html" title="Netty 核心原理剖析与 RPC 实践之ByteBuf 与内存管理-数据传输载体 ByteBuf">     <img class="post_bg" src="/images/posts/cover/netty.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心原理剖析与 RPC 实践之ByteBuf 与内存管理-数据传输载体 ByteBuf"></a></div><div class="recent-post-info"><a class="article-title" href="/post/cb9ed29c.html" title="Netty 核心原理剖析与 RPC 实践之ByteBuf 与内存管理-数据传输载体 ByteBuf">Netty 核心原理剖析与 RPC 实践之ByteBuf 与内存管理-数据传输载体 ByteBuf</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-12T12:43:26.000Z" title="发表于 2021-10-12 12:43:26">2021-10-12</time></span></div><div class="content">另起炉灶：Netty 数据传输载体 ByteBuf 详解我们看到 Netty 大量使用了自己实现的 ByteBuf 工具类，ByteBuf 是 Netty 的数据容器，所有网络通信中字节流的传输都是通过 ByteBuf 完成的。然而 JDK NIO 包中已经提供了类似的 ByteBuffer 类，为什么 Netty 还要去重复造轮子呢？
为什么选择 ByteBuf我们首先介绍下 JDK NIO 的 ByteBuffer，才能知道 ByteBuffer 有哪些缺陷和痛点。下图展示了 ByteBuffer 的内部结构：

从图中可知，ByteBuffer 包含以下四个基本属性：

mark：为某个读取过的关键位置做标记，方便回退到该位置；

position：当前读取的位置；

limit：buffer 中有效的数据长度大小；

capacity：初始化时的空间容量。


以上四个基本属性的关系是：mark &lt;= position &lt;= limit &lt;= capacity。结合 ByteBuffer 的基本属性，不难理解它在使用上的一些缺陷。
第一，ByteBuffer  ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/a17bea6c.html" title="Netty 核心原理剖析与 RPC 实践之编解码-自定义协议通信">     <img class="post_bg" src="/images/posts/cover/netty.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心原理剖析与 RPC 实践之编解码-自定义协议通信"></a></div><div class="recent-post-info"><a class="article-title" href="/post/a17bea6c.html" title="Netty 核心原理剖析与 RPC 实践之编解码-自定义协议通信">Netty 核心原理剖析与 RPC 实践之编解码-自定义协议通信</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-11T21:13:46.000Z" title="发表于 2021-10-11 21:13:46">2021-10-11</time></span></div><div class="content">接头暗语：如何利用 Netty 实现自定义协议通信？既然是网络编程，自然离不开通信协议，应用层之间通信需要实现各种各样的网络协议。在项目开发的过程中，我们就需要去构建满足自己业务场景的应用层协议。我们之前介绍了如何使用网络协议解决 TCP 拆包/粘包的底层问题，现在我们将在此基础上继续讨论如何设计一个高效、可扩展、易维护的自定义通信协议，以及如何使用 Netty 实现自定义通信协议。
通信协议设计所谓协议，就是通信双方事先商量好的接口暗语，在 TCP 网络编程中，发送方和接收方的数据包格式都是二进制，发送方将对象转化成二进制流发送给接收方，接收方获得二进制数据后需要知道如何解析成对象，所以协议是双方能够正常通信的基础。
目前市面上已经有不少通用的协议，例如 HTTP、HTTPS、JSON-RPC、FTP、IMAP、Protobuf 等。通用协议兼容性好，易于维护，各种异构系统之间可以实现无缝对接。如果在满足业务场景以及性能需求的前提下，推荐采用通用协议的方案。相比通用协议，自定义协议主要有以下优点。

极致性能：通用的通信协议考虑了很多兼容性的因素，必然在性能方面有所损失。
扩展性：自 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/db3b2224.html" title="Netty 核心原理剖析与 RPC 实践之编解码-粘包/拆包问题">     <img class="post_bg" src="/images/posts/cover/netty.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心原理剖析与 RPC 实践之编解码-粘包/拆包问题"></a></div><div class="recent-post-info"><a class="article-title" href="/post/db3b2224.html" title="Netty 核心原理剖析与 RPC 实践之编解码-粘包/拆包问题">Netty 核心原理剖析与 RPC 实践之编解码-粘包/拆包问题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-11T20:42:35.000Z" title="发表于 2021-10-11 20:42:35">2021-10-11</time></span></div><div class="content">粘包/拆包问题：如何获取一个完整的网络包？我们将学习 Netty 通信过程中的编解码技术。编解码技术这是实现网络通信的基础，让我们可以定义任何满足业务需求的应用层协议。在网络编程中，我们经常会使用各种网络传输协议，其中 TCP 是最常用的协议。我们首先需要了解的是 TCP 最基本的拆包/粘包问题以及常用的解决方案，才能更好地理解 Netty 的编解码框架。
为什么有拆包/粘包TCP 传输协议是面向流的，没有数据包界限。客户端向服务端发送数据时，可能将一个完整的报文拆分成多个小报文进行发送，也可能将多个报文合并成一个大的报文进行发送。因此就有了拆包和粘包。
为什么会出现拆包/粘包现象呢？在网络通信的过程中，每次可以发送的数据包大小是受多种因素限制的，如 MTU 传输单元大小、MSS 最大分段大小、滑动窗口等。如果一次传输的网络包数据大小超过传输单元大小，那么我们的数据可能会拆分为多个数据包发送出去。如果每次请求的网络包数据都很小，一共请求了 10000 次，TCP 并不会分别发送 10000 次。因为 TCP 采用的 Nagle 算法对此作出了优化。如果你是一位网络新手，可能对这些概念并 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/a38d6733.html" title="Netty 核心原理剖析与 RPC 实践之基础架构-服务编排层">     <img class="post_bg" src="/images/posts/cover/netty.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心原理剖析与 RPC 实践之基础架构-服务编排层"></a></div><div class="recent-post-info"><a class="article-title" href="/post/a38d6733.html" title="Netty 核心原理剖析与 RPC 实践之基础架构-服务编排层">Netty 核心原理剖析与 RPC 实践之基础架构-服务编排层</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-11T12:49:36.000Z" title="发表于 2021-10-11 12:49:36">2021-10-11</time></span></div><div class="content">服务编排层：Pipeline 如何协调各类 Handler ？我们知道 EventLoop 可以说是 Netty 的调度中心，负责监听多种事件类型：I/O 事件、信号事件、定时事件等，然而实际的业务处理逻辑则是由 ChannelPipeline 中所定义的 ChannelHandler 完成的，ChannelPipeline 和 ChannelHandler 也是我们在平时应用开发的过程中打交道最多的组件。Netty 服务编排层的核心组件 ChannelPipeline 和 ChannelHandler 为用户提供了 I/O 事件的全部控制权。
先抛出几个问题。

ChannelPipeline 与 ChannelHandler 的关系是什么？它们之间是如何协同工作的？

ChannelHandler 的类型有哪些？有什么区别？

Netty 中 I/O 事件是如何传播的？


ChannelPipeline 概述Pipeline 的字面意思是管道、流水线。它在 Netty 中起到的作用，和一个工厂的流水线类似。原始的网络字节流经过 Pipeline ，被一步步加工包装，最后得到加工后 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/39f712da.html" title="Netty 核心原理剖析与 RPC 实践之基础架构-事件调度层">     <img class="post_bg" src="/images/posts/cover/netty.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 核心原理剖析与 RPC 实践之基础架构-事件调度层"></a></div><div class="recent-post-info"><a class="article-title" href="/post/39f712da.html" title="Netty 核心原理剖析与 RPC 实践之基础架构-事件调度层">Netty 核心原理剖析与 RPC 实践之基础架构-事件调度层</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-10-10T21:40:10.000Z" title="发表于 2021-10-10 21:40:10">2021-10-10</time></span></div><div class="content">事件调度层：为什么 EventLoop 是 Netty 的精髓？Netty 高性能的奥秘在于其 Reactor 线程模型。 EventLoop 是 Netty Reactor 线程模型的核心处理引擎，那么它是如何高效地实现事件循环和任务处理机制的呢？
再谈 Reactor 线程模型网络框架的设计离不开 I/O 线程模型，线程模型的优劣直接决定了系统的吞吐量、可扩展性、安全性等。目前主流的网络框架几乎都采用了 I/O 多路复用的方案。Reactor 模式作为其中的事件分发器，负责将读写事件分发给对应的读写事件处理者。大名鼎鼎的 Java 并发包作者 Doug Lea，在 Scalable I/O in Java 一文中阐述了服务端开发中 I/O 模型的演进过程。Netty 中三种 Reactor 线程模型也来源于这篇经典文章。下面我们对这三种 Reactor 线程模型做一个详细的分析。
单线程模型
上图描述了 Reactor 的单线程模型结构，在 Reactor 单线程模型中，所有 I/O 操作（包括连接建立、数据读写、事件分发等），都是由一个线程完成的。单线程模型逻辑简单，缺陷也十分明 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/3/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/#content-inner">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/#content-inner">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/33/#content-inner">33</a><a class="extend next" rel="next" href="/page/5/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Leo Liu</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">322</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">82</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">46</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liule8"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LIULE8" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:leo.liu.scau@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">这里是公告</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/4a488f3.html" title="趣学设计模式之编程思维-对象思维"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="趣学设计模式之编程思维-对象思维"/></a><div class="content"><a class="title" href="/post/4a488f3.html" title="趣学设计模式之编程思维-对象思维">趣学设计模式之编程思维-对象思维</a><time datetime="2021-10-27T12:51:33.000Z" title="发表于 2021-10-27 12:51:33">2021-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/fa834f18.html" title="趣学设计模式之编程思维-工程思维"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="趣学设计模式之编程思维-工程思维"/></a><div class="content"><a class="title" href="/post/fa834f18.html" title="趣学设计模式之编程思维-工程思维">趣学设计模式之编程思维-工程思维</a><time datetime="2021-10-27T09:25:34.000Z" title="发表于 2021-10-27 09:25:34">2021-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/3de10f44.html" title="趣学设计模式之编程思维-分层思维"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="趣学设计模式之编程思维-分层思维"/></a><div class="content"><a class="title" href="/post/3de10f44.html" title="趣学设计模式之编程思维-分层思维">趣学设计模式之编程思维-分层思维</a><time datetime="2021-10-26T16:12:49.000Z" title="发表于 2021-10-26 16:12:49">2021-10-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/f50b517d.html" title="趣学设计模式之编程思维-组合思维"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="趣学设计模式之编程思维-组合思维"/></a><div class="content"><a class="title" href="/post/f50b517d.html" title="趣学设计模式之编程思维-组合思维">趣学设计模式之编程思维-组合思维</a><time datetime="2021-10-26T15:04:28.000Z" title="发表于 2021-10-26 15:04:28">2021-10-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/50738ec5.html" title="趣学设计模式之编程模式-"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="趣学设计模式之编程模式-"/></a><div class="content"><a class="title" href="/post/50738ec5.html" title="趣学设计模式之编程模式-">趣学设计模式之编程模式-</a><time datetime="2021-10-26T13:07:00.000Z" title="发表于 2021-10-26 13:07:00">2021-10-26</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JDK/"><span class="card-category-list-name">JDK</span><span class="card-category-list-count">4</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JDK/JDK8/"><span class="card-category-list-name">JDK8</span><span class="card-category-list-count">4</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/"><span class="card-category-list-name">Java</span><span class="card-category-list-count">83</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="card-category-list-name">多线程</span><span class="card-category-list-count">81</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JavaScript/"><span class="card-category-list-name">JavaScript</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MQ/"><span class="card-category-list-name">MQ</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Spring/"><span class="card-category-list-name">Spring</span><span class="card-category-list-count">55</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Spring/Spring-Data/"><span class="card-category-list-name">Spring Data</span><span class="card-category-list-count">33</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Spring/" style="font-size: 1.4em; color: rgb(125, 186, 146)">Spring</a><a href="/tags/JPA/" style="font-size: 1.15em; color: rgb(37, 53, 173)">JPA</a><a href="/tags/Spring-Data/" style="font-size: 1.35em; color: rgb(54, 88, 32)">Spring Data</a><a href="/tags/Spring-Data-JPA/" style="font-size: 1.38em; color: rgb(188, 80, 161)">Spring Data JPA</a><a href="/tags/Vue/" style="font-size: 1.17em; color: rgb(113, 74, 27)">Vue</a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" style="font-size: 1.15em; color: rgb(96, 147, 78)">面向对象设计原则</a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.17em; color: rgb(31, 196, 19)">架构</a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.22em; color: rgb(151, 109, 27)">算法</a><a href="/tags/UML/" style="font-size: 1.17em; color: rgb(55, 153, 110)">UML</a><a href="/tags/%E9%94%81/" style="font-size: 1.17em; color: rgb(37, 87, 170)">锁</a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 1.15em; color: rgb(144, 52, 17)">集合</a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.17em; color: rgb(155, 131, 28)">并发</a><a href="/tags/%E6%B3%A8%E8%A7%A3/" style="font-size: 1.22em; color: rgb(132, 67, 191)">注解</a><a href="/tags/JVM/" style="font-size: 1.25em; color: rgb(129, 29, 147)">JVM</a><a href="/tags/Java/" style="font-size: 1.45em; color: rgb(30, 126, 142)">Java</a><a href="/tags/CompletableFuture/" style="font-size: 1.15em; color: rgb(1, 4, 194)">CompletableFuture</a><a href="/tags/Future/" style="font-size: 1.15em; color: rgb(166, 22, 190)">Future</a><a href="/tags/JavaScript/" style="font-size: 1.15em; color: rgb(140, 115, 137)">JavaScript</a><a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 1.42em; color: rgb(134, 128, 12)">并发编程</a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 1.42em; color: rgb(19, 74, 167)">线程</a><a href="/tags/MySQL/" style="font-size: 1.32em; color: rgb(148, 24, 70)">MySQL</a><a href="/tags/I-O%E6%A8%A1%E5%9E%8B/" style="font-size: 1.38em; color: rgb(141, 104, 38)">I\O模型</a><a href="/tags/Netty/" style="font-size: 1.38em; color: rgb(4, 176, 85)">Netty</a><a href="/tags/Socket%E7%BC%96%E7%A8%8B/" style="font-size: 1.38em; color: rgb(110, 57, 65)">Socket编程</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.17em; color: rgb(96, 145, 169)">数据库</a><a href="/tags/Oracle/" style="font-size: 1.17em; color: rgb(189, 197, 90)">Oracle</a><a href="/tags/SQL/" style="font-size: 1.17em; color: rgb(162, 81, 27)">SQL</a><a href="/tags/pageable/" style="font-size: 1.15em; color: rgb(167, 146, 97)">pageable</a><a href="/tags/RestTemplate/" style="font-size: 1.15em; color: rgb(59, 117, 20)">RestTemplate</a><a href="/tags/String/" style="font-size: 1.3em; color: rgb(192, 87, 140)">String</a><a href="/tags/Springboot/" style="font-size: 1.2em; color: rgb(177, 91, 194)">Springboot</a><a href="/tags/Annotation/" style="font-size: 1.17em; color: rgb(194, 17, 185)">Annotation</a><a href="/tags/JpaSpecificationExecutor/" style="font-size: 1.2em; color: rgb(119, 61, 45)">JpaSpecificationExecutor</a><a href="/tags/%E4%B9%90%E8%A7%82%E9%94%81/" style="font-size: 1.15em; color: rgb(198, 0, 64)">乐观锁</a><a href="/tags/Spring-Security/" style="font-size: 1.27em; color: rgb(103, 6, 126)">Spring Security</a><a href="/tags/Transaction/" style="font-size: 1.15em; color: rgb(174, 89, 178)">Transaction</a><a href="/tags/redis/" style="font-size: 1.15em; color: rgb(73, 113, 141)">redis</a><a href="/tags/Join/" style="font-size: 1.15em; color: rgb(73, 163, 43)">Join</a><a href="/tags/Time/" style="font-size: 1.15em; color: rgb(90, 32, 71)">Time</a><a href="/tags/Mixin/" style="font-size: 1.17em; color: rgb(76, 166, 31)">Mixin</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/10/"><span class="card-archive-list-date">十月 2021</span><span class="card-archive-list-count">86</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/09/"><span class="card-archive-list-date">九月 2021</span><span class="card-archive-list-count">106</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">八月 2021</span><span class="card-archive-list-count">27</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/07/"><span class="card-archive-list-date">七月 2021</span><span class="card-archive-list-count">21</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/06/"><span class="card-archive-list-date">六月 2021</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/04/"><span class="card-archive-list-date">四月 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/02/"><span class="card-archive-list-date">二月 2021</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">一月 2021</span><span class="card-archive-list-count">11</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">322</div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">961.6k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2021-10-27T11:17:36.032Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Leo Liu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function subtitleType () {
  fetch('https://api.btstu.cn/yan/api.php?charset=utf-8&encode=json')
    .then(response => response.json())
    .then(data => {
      if (true) {
        var sub = "".length == 0 ? new Array() : "".split(',')
        var both = sub.unshift(data.text)
        typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = data.text
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>