<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Leo's notes</title><meta name="author" content="Leo Liu"><meta name="copyright" content="Leo Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Leo&#39;s notes">
<meta property="og:url" content="https://liule8.github.io/page/33/index.html">
<meta property="og:site_name" content="Leo&#39;s notes">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://liule8.github.io/images/avatar.png">
<meta property="article:author" content="Leo Liu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://liule8.github.io/images/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://liule8.github.io/page/33/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2021-12-07 11:36:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/images/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">428</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">84</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">51</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Leo's notes</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Leo's notes</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/LIULE8" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:leo.liu.scau@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/166a77f9.html" title="应用性能分析之故障定位VisualVM">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="应用性能分析之故障定位VisualVM"></a></div><div class="recent-post-info"><a class="article-title" href="/post/166a77f9.html" title="应用性能分析之故障定位VisualVM">应用性能分析之故障定位VisualVM</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-08-04T14:11:43.000Z" title="发表于 2021-08-04 14:11:43">2021-08-04</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">应用性能分析</a></span></div><div class="content">故障定位：Java VisualVM，第一款多合一的轻量可视化工具
Java VisualVM（All-in-One Java Troubleshooting Tool），VisualVM 是第一款集成了Java 命令行工具和支持实时在线问题分析的轻量级可视化工具，作为 Oracle Java 6 的一部分对外发布。
在上个年代，VisualVM 因为使用 JMX 规范，所以接入非常简单；而且 VisualVM 是多合一的生态架构，有很多第三方提供的扩展功能，具备强大的插件体系。所以在发布早期，就深受开发人员和企业的关注。
但遗憾的是，尽管 VisualVM 是官方制作且如此经典，可是在定位线上问题和场景剖析时，很多一线开发人员还是没有使用起来这个工具。

通过落地方案，熟悉 VisualVM 在落地过程中需要规避的风险；
通过学习路径，掌握如何学习 VisualVM。争取在定位问题时，提高 VisualVM 的使用率和定位问题的效率。

落地方案
VisualVM 的部署非常简单，在应用服务的启动命令中，增加相应的 JMX 管理功能参数，然后在本地使用 VisualVM 客户端连接  ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/7a5442f2.html" title="应用性能分析之流量卫士Sentinel">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="应用性能分析之流量卫士Sentinel"></a></div><div class="recent-post-info"><a class="article-title" href="/post/7a5442f2.html" title="应用性能分析之流量卫士Sentinel">应用性能分析之流量卫士Sentinel</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-08-04T09:02:22.000Z" title="发表于 2021-08-04 09:02:22">2021-08-04</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">应用性能分析</a></span></div><div class="content">流量卫士：Alibaba Sentinel 时刻守卫流量健康
Sentinel 是阿里开源的分布式架构的高可用防护工具，它以流量为切入点，提供流量控制、流量塑形、熔断降级和过载保护等多维度的高可用保障策略。
Sentinel 在阿里内部经历了多年“双十一”的锤炼，完美地保障了微服务在大促场景下的稳定性。阿里在 2018 年底发布了首个开源生产版本，与其他开源系统不同的是，Sentinel 对外发布早期版本就具备了完整的核心架构，以及极高的生产可用能力。
首个开源版本发布后，Sentinel 便开始着力生态发展，如下图所示：Sentinel 提供更多 Java 微服务框架的开箱即用能力；同时 Sentinel 专注 API 网关服务，让开发者的高可用配置尽可能地收口，并着力于拥抱多语言生态和云原生支持的能力建设。

Java 微服务框架适配： Sentinel 与其他 APM 系统（如 SkyWalking、CAT）监控框架的实现方式类似，通过插件化扩展和实现框架拦截器的方式，对 Java 微服务的 Web 服务端、RPC 框架、HTTP 客户端、消息队列等多个方向的框架进行适配。

详 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/448c0baf.html" title="应用性能分析之诊断利器Arthas">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="应用性能分析之诊断利器Arthas"></a></div><div class="recent-post-info"><a class="article-title" href="/post/448c0baf.html" title="应用性能分析之诊断利器Arthas">应用性能分析之诊断利器Arthas</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-08-03T09:34:22.000Z" title="发表于 2021-08-03 09:34:22">2021-08-03</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">应用性能分析</a></span></div><div class="content">诊断利器：Java 性能分析神器 Alibaba Arthas
Arthas 是阿里开源的 Java 诊断工具，可以让开发者快速定位故障问题，那么为什么用“神器”来形容 Arthas 呢？
Arthas 由阿里早期的开源诊断工具 Greys 演进而来，可以将 Arthas 看作是Greys的升级产品。由于 Arthas 提供了更加丰富的工具，在 2018 年底发布，就受到了很多开发者的青睐，并且也得到了来自 Java 官方的赞许。
Arthas 的核心应用场景如下。


场景 1：这个类从哪个 jar 包加载的？为什么会报各种类相关的 Exception？


场景 2：我改的代码为什么没有执行？难道是我没 commit？分支搞错了？


场景 3：遇到问题无法在线上 debug，难道只能通过加日志再重新发布吗？


场景 4：线上遇到某个用户的数据处理有问题，但线上同样无法 debug，线下无法重现！


场景 5：是否有一个全局视角来查看系统的运行状况？


场景 6：有什么办法可以监控到 JVM 的实时运行状态？


场景 7：怎么快速定位应用的热点，生成火焰图？


总结起来就 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/91562a20.html" title="应用性能分析之系统监控CAT">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="应用性能分析之系统监控CAT"></a></div><div class="recent-post-info"><a class="article-title" href="/post/91562a20.html" title="应用性能分析之系统监控CAT">应用性能分析之系统监控CAT</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-08-02T22:07:22.000Z" title="发表于 2021-08-02 22:07:22">2021-08-02</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">应用性能分析</a></span></div><div class="content">系统监控：老牌监控点评 CAT，依然经久不衰
为什么会以“老牌”和“经久不衰”来形容点评 CAT（Central Application Tracking）呢？
首先，从时间上看，CAT 首个开源版本是在 2012 年，此时期与 APM 相关重大事件有：


Google 公司发布《Dapper 论文》；


紧随其后，Naver 公司发布开源无侵入 APM 系统 Pinpoint；


Twitter 公司发布开源 APM 系统 Zipkin，Zipkin 是 Spring Cloud 分布式追踪系统 Spring-Cloud-Sleuth 的解决方案。


但其实 CAT 的时间比 Dapper、Pinpoint 和 Zipkin 更早，它的核心设计思路源自 2000 年初 eBay 的内源 APM 产品 CAL（Centralized Application Logging），所以在时间轴上看 CAT 是足够老牌的。
其次，从已登记的落地案例上来看，CAT 从开源初期至今，在国内已经经历了非常多公司的复杂场景和海量流量的考验了。目前 CAT 在国内有数百家企业的部署案例，代码的变 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/a274b556.html" title="应用性能分析之APM引领者SkyWalking">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="应用性能分析之APM引领者SkyWalking"></a></div><div class="recent-post-info"><a class="article-title" href="/post/a274b556.html" title="应用性能分析之APM引领者SkyWalking">应用性能分析之APM引领者SkyWalking</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-08-01T22:07:22.000Z" title="发表于 2021-08-01 22:07:22">2021-08-01</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/">应用性能分析</a></span></div><div class="content">APM 引领者：Apache SkyWalking 的开放、共享精神

APM（Application Performance Management），也称应用性能分析系统。

Apache SkyWalking 在国际上是非常受欢迎的 APM 系统，在 APM 的核心领域（如全链路追踪、网站性能）都非常具有前瞻性。
它采用字节码增强技术，极大地降低了接入成本；支持 Java、.Net 等多语言探针，并提供 Dubbo、gRPC 等多种开源框架插件；诞生于社区，没有企业束缚和语言障碍。其开放、共享精神让其成为当之无愧的“APM 引领者”。
接下来，将通过 Apache SkyWalking 的发展历程和企业级的实践经验，来讲述 APM 引领者 SkyWaling 是如何进行大规模落地的。
Apache SkyWalking 发展历程
SkyWalking 项目从 2017 年 12 月进入 Apache 孵化器，到现在的 8.X 版本已经迭代了 4 个大版本。
下面回顾下这 4 个大版本，了解一下在过去三年，Apache SkyWalking 在哪些 APM 领域都进行了哪些核心功能上 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/576d8222.html" title="Spring Security之框架拓展-测试驱动">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之框架拓展-测试驱动"></a></div><div class="recent-post-info"><a class="article-title" href="/post/576d8222.html" title="Spring Security之框架拓展-测试驱动">Spring Security之框架拓展-测试驱动</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-31T22:46:23.000Z" title="发表于 2021-07-31 22:46:23">2021-07-31</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">测试驱动：如何基于 Spring Security 测试系统安全性？
对于安全性而言，测试是一个难点，也是经常被忽略的一套技术体系。
如何对系统的安全性进行测试？
Spring Security 是一款安全性开发框架，提供的是内嵌到业务系统中的基础设施类功能。因此，势必会涉及大量组件之间的依赖关系，这是测试安全性功能所面临的最大挑战，需要采用特定的测试方法。因此，在介绍具体的测试用例之前，我们先来梳理一下安全性测试方法，以及 Spring Security 中为我们提供的测试解决方案。
安全性测试与 Mock 机制
正如前面提到的，验证安全性功能正确性的难点在于组件与组件之间的依赖关系，为了弄清楚这个关系，这里就需要引出测试领域非常重要的一个概念，即 Mock（模拟）。针对测试组件涉及的外部依赖，关注点在于这些组件之间的调用关系，以及返回的结果或发生的异常等，而不是组件内部的执行过程。因此常见的技巧就是使用 Mock 对象来替代真实的依赖对象，从而模拟真实的调用场景。
以一个常见的三层 Web 服务架构为例来进一步解释 Mock 的实施方法。Controller 层会访问 Servic ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/ee25fdeb.html" title="Spring Security之框架拓展-技术趋势">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之框架拓展-技术趋势"></a></div><div class="recent-post-info"><a class="article-title" href="/post/ee25fdeb.html" title="Spring Security之框架拓展-技术趋势">Spring Security之框架拓展-技术趋势</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-31T22:19:26.000Z" title="发表于 2021-07-31 22:19:26">2021-07-31</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">技术趋势：如何为 Spring Security 添加响应式编程特性？
对于大多数日常业务场景而言，软件系统在任何时候都需要确保具备即时响应性。而响应式编程（Reactive Programming）就是用来构建具有即时响应性的是一种新的编程技术。随着 Spring 5 的发布，迎来了响应式编程的全新发展时期。而 Spring Security 作为 Spring 家族的一员，同样实现了一系列的响应式组件。
什么是响应式编程？
在引入响应式 Spring Security 之前，先来介绍响应式编程中的一些基本概念，并给出 Spring 5 中所集成的响应式编程组件。
响应式编程的基本概念
在响应式系统中，任何操作都可以被看作是一种事件，而这些事件构成了数据流。这个数据流对于技术栈而言是一个全流程的概念。也就是说，无论是从底层数据库，向上到达服务层，最后到 Web 层，亦或是在这个流程中所包含的任意中间层组件，整个数据传递链路都应该是采用事件驱动的方式来进行运作。这样，就可以不采用传统的同步调用方式来处理数据，而是由位于数据库上游的各层组件自动来执行事件。这就是响应式编程的核心特点。
针 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/365f5d49.html" title="Spring Security之OAuth2与微服务-案例实战(二)">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之OAuth2与微服务-案例实战(二)"></a></div><div class="recent-post-info"><a class="article-title" href="/post/365f5d49.html" title="Spring Security之OAuth2与微服务-案例实战(二)">Spring Security之OAuth2与微服务-案例实战(二)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-31T10:59:26.000Z" title="发表于 2021-07-31 10:59:26">2021-07-31</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">案例实战：基于 Spring Security 和 OAuth2 实现单点登录
单点登录（Single Sign-On，SSO）是设计和实现 Web 系统时经常需要面临的一个问题，允许用户使用一组凭据来登录多个相互独立但又需要保持统一登录状态的 Web 应用程序。单点登录的实现需要特定的技术和框架，而 Spring Security 也提供了它的解决方案 – 将基于 OAuth2 协议来构建 SSO。
什么是单点登录？
与其说 SSO 是一种技术体系，不如说它是一种应用场景。因此，有必要先来看看 SSO 与各种技术体系之间的关联关系。
单点登录与OAuth2协议
假设存在 A 和 B 两个独立的系统，但它们相互信任，并通过单点登录系统进行了统一的管理和维护。那么无论访问系统 A 还是系统 B，当用户在身份认证服务器上登录一次以后，即可获得访问另一个系统的权限。同时这个过程是完全自动化的，SSO 通过实现集中式登录系统来达到这一目标，该系统处理用户的身份认证并与其他应用程序共享该认证信息。
说到这里，你可能会问为什么需要实施 SSO 呢？原因很简单，因为它提供了很多优势：

首先，借助  ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/996ec62b.html" title="Spring Security之OAuth2与微服务-案例实战(一)">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之OAuth2与微服务-案例实战(一)"></a></div><div class="recent-post-info"><a class="article-title" href="/post/996ec62b.html" title="Spring Security之OAuth2与微服务-案例实战(一)">Spring Security之OAuth2与微服务-案例实战(一)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-31T09:54:26.000Z" title="发表于 2021-07-31 09:54:26">2021-07-31</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">案例实战：基于 Spring Security 和 Spring Cloud 构建微服务安全架构
设计一个案例系统，从零构建一个完整的微服务系统，演示微服务系统构建过程并展示 OAuth2 协议以及 JWT 在其中所起到的作用。
案例驱动：SpringAppointment
SpringAppointment 包含的业务场景比较简单，可以用来模拟就医过程中的预约处理流程。一般而言，预约流程势必会涉及三个独立的微服务，即就诊卡（Card）服务、预约（Appointment）服务，以及医生（Doctor）服务。
把以上三个服务统称为业务服务。纵观整个 SpringAppointment 系统，除了这三个业务微服务之外，还有一批非业务性的基础设施类服务，具体包括：注册中心服务（Eureka）、配置中心服务（Spring Cloud Config），以及 API 网关服务（Zuul）。
虽然案例中的各个服务在物理上都是独立的，但就整个系统而言，需要各服务相互协作构成一个完整的微服务系统。也就是说，服务运行时存在一定的依赖性。结合系统架构对 SpringAppointment 的运行方式进行梳理 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/2ce024a1.html" title="Spring Security之OAuth2与微服务-令牌拓展">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之OAuth2与微服务-令牌拓展"></a></div><div class="recent-post-info"><a class="article-title" href="/post/2ce024a1.html" title="Spring Security之OAuth2与微服务-令牌拓展">Spring Security之OAuth2与微服务-令牌拓展</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-30T12:54:26.000Z" title="发表于 2021-07-30 12:54:26">2021-07-30</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">令牌扩展：如何使用 JWT 实现定制化 Token？
事实上，在 OAuth2 协议中并没有明确规定 Token 具体的组成结构，而在现实应用中，不建议使用之前用到的 Token 格式，而是更倾向于采用 JWT。
什么是 JWT？
JWT 的全称是 JSON Web Token，所以它本质上是一种基于 JSON 表示的 Token。JWT 的设计目标就是为 OAuth2 协议中使用的 Token 提供一种标准结构，所以它经常与 OAuth2 协议集成在一起使用。
JWT 的基本结构
从结构上讲，JWT 本身由三段信息构成：第一段为头部（Header），第二段为有效负载（Payload），第三段为签名（Signature）。
1header. payload. signature
从数据格式上来看，以上三个部分的内容都是一个 JSON 对象。在 JWT 中，每一段 JSON 对象都用 Base64 进行编码，编码后的内容用“.”号连接一起，所以 JWT 本质上就是一个字符串。如下所示即为一个 JWT 字符串的示例：
1eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/32/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/32/#content-inner">32</a><span class="page-number current">33</span><a class="page-number" href="/page/34/#content-inner">34</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/#content-inner">43</a><a class="extend next" rel="next" href="/page/34/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Leo Liu</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">428</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">84</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">51</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liule8"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LIULE8" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:leo.liu.scau@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">这里是公告</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/da59c978.html" title="Java并发编程(二)"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java并发编程(二)"/></a><div class="content"><a class="title" href="/post/da59c978.html" title="Java并发编程(二)">Java并发编程(二)</a><time datetime="2021-12-06T20:31:07.000Z" title="发表于 2021-12-06 20:31:07">2021-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/a50eaa86.html" title="数据结构与算法之高级篇-位图"><img src="/images/posts/cover/dataStructuresAndAlgorithms.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构与算法之高级篇-位图"/></a><div class="content"><a class="title" href="/post/a50eaa86.html" title="数据结构与算法之高级篇-位图">数据结构与算法之高级篇-位图</a><time datetime="2021-12-06T19:59:30.000Z" title="发表于 2021-12-06 19:59:30">2021-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/accf4e02.html" title="数据结构与算法之高级篇-最短路径"><img src="/images/posts/cover/dataStructuresAndAlgorithms.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构与算法之高级篇-最短路径"/></a><div class="content"><a class="title" href="/post/accf4e02.html" title="数据结构与算法之高级篇-最短路径">数据结构与算法之高级篇-最短路径</a><time datetime="2021-12-04T13:03:30.000Z" title="发表于 2021-12-04 13:03:30">2021-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/4233c11f.html" title="数据结构与算法之高级篇-拓扑排序"><img src="/images/posts/cover/dataStructuresAndAlgorithms.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构与算法之高级篇-拓扑排序"/></a><div class="content"><a class="title" href="/post/4233c11f.html" title="数据结构与算法之高级篇-拓扑排序">数据结构与算法之高级篇-拓扑排序</a><time datetime="2021-12-04T12:25:30.000Z" title="发表于 2021-12-04 12:25:30">2021-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/c24b527c.html" title="数据结构与算法之基础篇-动态规划实战"><img src="/images/posts/cover/dataStructuresAndAlgorithms.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构与算法之基础篇-动态规划实战"/></a><div class="content"><a class="title" href="/post/c24b527c.html" title="数据结构与算法之基础篇-动态规划实战">数据结构与算法之基础篇-动态规划实战</a><time datetime="2021-12-02T19:39:46.000Z" title="发表于 2021-12-02 19:39:46">2021-12-02</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JDK/"><span class="card-category-list-name">JDK</span><span class="card-category-list-count">4</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JDK/JDK8/"><span class="card-category-list-name">JDK8</span><span class="card-category-list-count">4</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JVM/"><span class="card-category-list-name">JVM</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/"><span class="card-category-list-name">Java</span><span class="card-category-list-count">84</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="card-category-list-name">多线程</span><span class="card-category-list-count">82</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JavaScript/"><span class="card-category-list-name">JavaScript</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MQ/"><span class="card-category-list-name">MQ</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MyBatis/"><span class="card-category-list-name">MyBatis</span><span class="card-category-list-count">4</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Spring/" style="font-size: 1.41em; color: rgb(119, 120, 199)">Spring</a><a href="/tags/JPA/" style="font-size: 1.15em; color: rgb(41, 117, 72)">JPA</a><a href="/tags/Spring-Data/" style="font-size: 1.33em; color: rgb(94, 71, 188)">Spring Data</a><a href="/tags/Vue/" style="font-size: 1.17em; color: rgb(43, 146, 189)">Vue</a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" style="font-size: 1.15em; color: rgb(146, 158, 116)">面向对象设计原则</a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.17em; color: rgb(71, 175, 37)">架构</a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.39em; color: rgb(83, 47, 167)">算法</a><a href="/tags/UML/" style="font-size: 1.17em; color: rgb(14, 64, 195)">UML</a><a href="/tags/%E9%94%81/" style="font-size: 1.17em; color: rgb(145, 151, 39)">锁</a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 1.15em; color: rgb(29, 4, 109)">集合</a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.17em; color: rgb(196, 102, 19)">并发</a><a href="/tags/%E6%B3%A8%E8%A7%A3/" style="font-size: 1.21em; color: rgb(59, 159, 54)">注解</a><a href="/tags/Spring-Data-Jpa/" style="font-size: 1.35em; color: rgb(42, 98, 182)">Spring Data Jpa</a><a href="/tags/JVM/" style="font-size: 1.23em; color: rgb(89, 133, 168)">JVM</a><a href="/tags/Java/" style="font-size: 1.45em; color: rgb(9, 160, 151)">Java</a><a href="/tags/CompletableFuture/" style="font-size: 1.15em; color: rgb(32, 179, 17)">CompletableFuture</a><a href="/tags/Future/" style="font-size: 1.15em; color: rgb(162, 119, 196)">Future</a><a href="/tags/JavaScript/" style="font-size: 1.15em; color: rgb(183, 62, 87)">JavaScript</a><a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 1.43em; color: rgb(6, 198, 49)">并发编程</a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 1.43em; color: rgb(150, 24, 35)">线程</a><a href="/tags/MySQL/" style="font-size: 1.31em; color: rgb(139, 144, 80)">MySQL</a><a href="/tags/I-O%E6%A8%A1%E5%9E%8B/" style="font-size: 1.37em; color: rgb(46, 137, 68)">I\O模型</a><a href="/tags/Netty/" style="font-size: 1.37em; color: rgb(195, 194, 129)">Netty</a><a href="/tags/Socket%E7%BC%96%E7%A8%8B/" style="font-size: 1.37em; color: rgb(91, 110, 82)">Socket编程</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.17em; color: rgb(183, 84, 15)">数据库</a><a href="/tags/Oracle/" style="font-size: 1.17em; color: rgb(15, 26, 169)">Oracle</a><a href="/tags/SQL/" style="font-size: 1.17em; color: rgb(98, 185, 164)">SQL</a><a href="/tags/pageable/" style="font-size: 1.15em; color: rgb(62, 68, 7)">pageable</a><a href="/tags/RestTemplate/" style="font-size: 1.15em; color: rgb(90, 45, 59)">RestTemplate</a><a href="/tags/Spark/" style="font-size: 1.29em; color: rgb(119, 6, 1)">Spark</a><a href="/tags/String/" style="font-size: 1.27em; color: rgb(167, 17, 145)">String</a><a href="/tags/Springboot/" style="font-size: 1.19em; color: rgb(146, 155, 40)">Springboot</a><a href="/tags/Annotation/" style="font-size: 1.17em; color: rgb(31, 194, 95)">Annotation</a><a href="/tags/JpaSpecificationExecutor/" style="font-size: 1.19em; color: rgb(150, 165, 153)">JpaSpecificationExecutor</a><a href="/tags/%E4%B9%90%E8%A7%82%E9%94%81/" style="font-size: 1.15em; color: rgb(16, 195, 152)">乐观锁</a><a href="/tags/Spring-Security/" style="font-size: 1.25em; color: rgb(36, 18, 36)">Spring Security</a><a href="/tags/Transaction/" style="font-size: 1.15em; color: rgb(91, 159, 44)">Transaction</a><a href="/tags/redis/" style="font-size: 1.15em; color: rgb(56, 59, 164)">redis</a><a href="/tags/Join/" style="font-size: 1.15em; color: rgb(198, 41, 157)">Join</a><a href="/tags/Time/" style="font-size: 1.15em; color: rgb(195, 132, 48)">Time</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/12/"><span class="card-archive-list-date">十二月 2021</span><span class="card-archive-list-count">8</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/11/"><span class="card-archive-list-date">十一月 2021</span><span class="card-archive-list-count">79</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/10/"><span class="card-archive-list-date">十月 2021</span><span class="card-archive-list-count">105</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/09/"><span class="card-archive-list-date">九月 2021</span><span class="card-archive-list-count">106</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">八月 2021</span><span class="card-archive-list-count">27</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/07/"><span class="card-archive-list-date">七月 2021</span><span class="card-archive-list-count">21</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/06/"><span class="card-archive-list-date">六月 2021</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/04/"><span class="card-archive-list-date">四月 2021</span><span class="card-archive-list-count">1</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">428</div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">1377.4k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2021-12-07T11:36:22.338Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Leo Liu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function subtitleType () {
  fetch('https://api.btstu.cn/yan/api.php?charset=utf-8&encode=json')
    .then(response => response.json())
    .then(data => {
      if (true) {
        var sub = "".length == 0 ? new Array() : "".split(',')
        var both = sub.unshift(data.text)
        typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = data.text
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>