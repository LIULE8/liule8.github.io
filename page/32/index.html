<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Leo's notes</title><meta name="author" content="Leo Liu"><meta name="copyright" content="Leo Liu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Leo&#39;s notes">
<meta property="og:url" content="https://liule8.github.io/page/32/index.html">
<meta property="og:site_name" content="Leo&#39;s notes">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://liule8.github.io/images/avatar.png">
<meta property="article:author" content="Leo Liu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://liule8.github.io/images/avatar.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://liule8.github.io/page/32/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-01-14 08:37:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/images/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">416</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">91</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Leo's notes</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Leo's notes</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/LIULE8" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:leo.liu.scau@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/9d682204.html" title="高并发下 MQ 如何保证顺序消费">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="高并发下 MQ 如何保证顺序消费"></a></div><div class="recent-post-info"><a class="article-title" href="/post/9d682204.html" title="高并发下 MQ 如何保证顺序消费">高并发下 MQ 如何保证顺序消费</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-08-18T10:58:56.000Z" title="发表于 2021-08-18 10:58:56">2021-08-18</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/MQ/">MQ</a></span></div><div class="content">高并发下 MQ 如何保证顺序消费？

前提：
关于消息队列中的时序问题。是因为有一些程序员只会简单地写“生产”跟“消费”的代码，但对 MQ 的一些注意事项都不甚明了。

MQ 本身就是为了“分布式”与“高并发”设计的中间件，但这两个场景本身就决定了：一些小问题就很容易引起大麻烦。所以如果你不能对 MQ 的特性了如指掌，那么写出来的代码一旦上了生产，就会引发生产事故，而且还是不易排查的那种。
所以今天就聊聊 MQ 特性中的一点——如何保证顺序？以及如何应对意外事件的处理，避免事故的发生。
时序的业务场景
我们在使用消息队列时都知道，写出生产端与消费端的 happy path 代码并不难，难点往往在于 MQ 的几个要点：不丢消息、重试、延时、幂等、时序等，这几个要点往往逻辑复杂。


前面说的 happy path 的代码，只需要 20% 的时间就能满足 80% 的场景；


但是后面这些要点，却需要用 80% 的时间满足剩下 20% 的场景。


来看一下 MQ 的简单示意图：


这里面有 3 个生产者，分别生产 Data1、Data2、Data3 三条消息到 MQ；


而后三个消费 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/bbb8d698.html" title="序列化接口">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="序列化接口"></a></div><div class="recent-post-info"><a class="article-title" href="/post/bbb8d698.html" title="序列化接口">序列化接口</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-08-17T09:01:04.000Z" title="发表于 2021-08-17 09:01:04">2021-08-17</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%BA%8F%E5%88%97%E5%8C%96/">序列化</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/%E5%BA%8F%E5%88%97%E5%8C%96/%E6%8E%A5%E5%8F%A3/">接口</a></span></div><div class="content">序列化接口
序列化使用场景

对象持久化；
在网络中传输对象；
在进程间传输对象；

共有两个接口Serializable和Externalizable
Serializable
Serializable 原理
为什么要实现Serializable接口才能序列化呢？
1234567891011121314151617// JDK8 java.io.ObjectOutputStream 1171行if (obj instanceof String) &#123;    writeString((String) obj, unshared);&#125; else if (cl.isArray()) &#123;    writeArray(obj, desc, unshared);&#125; else if (obj instanceof Enum) &#123;    writeEnum((Enum&lt;?&gt;) obj, desc, unshared);&#125; else if (obj instanceof Serializable) &#123;    writeOr ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/45e64f8b.html" title="序列化注解">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="序列化注解"></a></div><div class="recent-post-info"><a class="article-title" href="/post/45e64f8b.html" title="序列化注解">序列化注解</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-08-17T08:47:10.000Z" title="发表于 2021-08-17 08:47:10">2021-08-17</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%BA%8F%E5%88%97%E5%8C%96/">序列化</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/%E5%BA%8F%E5%88%97%E5%8C%96/%E6%B3%A8%E8%A7%A3/">注解</a></span></div><div class="content">Jackson的序列化注解

@JsonBackReference 和 @JsonManagedReference，以及 @JsonIgnore 都是为了解决对象中存在双向引用导致的无限递归（infinite recursion）问题。这些标注均可用在属性或对应的get、set方法中。

@JsonBackReference 和 @JsonManagedReference

@JsonBackReference 标注的属性在序列化（serialization，即将对象转换为json数据）时，会被忽略（即结果中的json数据不包含该属性的内容）。
@JsonManagedReference 标注的属性则会被序列化


注意：
@JsonBackReference 和 @JsonManagedReference 这两个标注通常配对使用。
在序列化时，@JsonBackReference 的作用相当于 @JsonIgnore，此时可以没有 @JsonManagedReference。
在反序列化（deserialization，即json数据转换为对象）时，如果没有加 @JsonManage ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/576d8222.html" title="Spring Security之框架拓展-测试驱动">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之框架拓展-测试驱动"></a></div><div class="recent-post-info"><a class="article-title" href="/post/576d8222.html" title="Spring Security之框架拓展-测试驱动">Spring Security之框架拓展-测试驱动</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-31T22:46:23.000Z" title="发表于 2021-07-31 22:46:23">2021-07-31</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">测试驱动：如何基于 Spring Security 测试系统安全性？
对于安全性而言，测试是一个难点，也是经常被忽略的一套技术体系。
如何对系统的安全性进行测试？
Spring Security 是一款安全性开发框架，提供的是内嵌到业务系统中的基础设施类功能。因此，势必会涉及大量组件之间的依赖关系，这是测试安全性功能所面临的最大挑战，需要采用特定的测试方法。因此，在介绍具体的测试用例之前，我们先来梳理一下安全性测试方法，以及 Spring Security 中为我们提供的测试解决方案。
安全性测试与 Mock 机制
正如前面提到的，验证安全性功能正确性的难点在于组件与组件之间的依赖关系，为了弄清楚这个关系，这里就需要引出测试领域非常重要的一个概念，即 Mock（模拟）。针对测试组件涉及的外部依赖，关注点在于这些组件之间的调用关系，以及返回的结果或发生的异常等，而不是组件内部的执行过程。因此常见的技巧就是使用 Mock 对象来替代真实的依赖对象，从而模拟真实的调用场景。
以一个常见的三层 Web 服务架构为例来进一步解释 Mock 的实施方法。Controller 层会访问 Servic ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/ee25fdeb.html" title="Spring Security之框架拓展-技术趋势">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之框架拓展-技术趋势"></a></div><div class="recent-post-info"><a class="article-title" href="/post/ee25fdeb.html" title="Spring Security之框架拓展-技术趋势">Spring Security之框架拓展-技术趋势</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-31T22:19:26.000Z" title="发表于 2021-07-31 22:19:26">2021-07-31</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">技术趋势：如何为 Spring Security 添加响应式编程特性？
对于大多数日常业务场景而言，软件系统在任何时候都需要确保具备即时响应性。而响应式编程（Reactive Programming）就是用来构建具有即时响应性的是一种新的编程技术。随着 Spring 5 的发布，迎来了响应式编程的全新发展时期。而 Spring Security 作为 Spring 家族的一员，同样实现了一系列的响应式组件。
什么是响应式编程？
在引入响应式 Spring Security 之前，先来介绍响应式编程中的一些基本概念，并给出 Spring 5 中所集成的响应式编程组件。
响应式编程的基本概念
在响应式系统中，任何操作都可以被看作是一种事件，而这些事件构成了数据流。这个数据流对于技术栈而言是一个全流程的概念。也就是说，无论是从底层数据库，向上到达服务层，最后到 Web 层，亦或是在这个流程中所包含的任意中间层组件，整个数据传递链路都应该是采用事件驱动的方式来进行运作。这样，就可以不采用传统的同步调用方式来处理数据，而是由位于数据库上游的各层组件自动来执行事件。这就是响应式编程的核心特点。
针 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/365f5d49.html" title="Spring Security之OAuth2与微服务-案例实战(二)">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之OAuth2与微服务-案例实战(二)"></a></div><div class="recent-post-info"><a class="article-title" href="/post/365f5d49.html" title="Spring Security之OAuth2与微服务-案例实战(二)">Spring Security之OAuth2与微服务-案例实战(二)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-31T10:59:26.000Z" title="发表于 2021-07-31 10:59:26">2021-07-31</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">案例实战：基于 Spring Security 和 OAuth2 实现单点登录
单点登录（Single Sign-On，SSO）是设计和实现 Web 系统时经常需要面临的一个问题，允许用户使用一组凭据来登录多个相互独立但又需要保持统一登录状态的 Web 应用程序。单点登录的实现需要特定的技术和框架，而 Spring Security 也提供了它的解决方案 – 将基于 OAuth2 协议来构建 SSO。
什么是单点登录？
与其说 SSO 是一种技术体系，不如说它是一种应用场景。因此，有必要先来看看 SSO 与各种技术体系之间的关联关系。
单点登录与OAuth2协议
假设存在 A 和 B 两个独立的系统，但它们相互信任，并通过单点登录系统进行了统一的管理和维护。那么无论访问系统 A 还是系统 B，当用户在身份认证服务器上登录一次以后，即可获得访问另一个系统的权限。同时这个过程是完全自动化的，SSO 通过实现集中式登录系统来达到这一目标，该系统处理用户的身份认证并与其他应用程序共享该认证信息。
说到这里，你可能会问为什么需要实施 SSO 呢？原因很简单，因为它提供了很多优势：

首先，借助  ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/996ec62b.html" title="Spring Security之OAuth2与微服务-案例实战(一)">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之OAuth2与微服务-案例实战(一)"></a></div><div class="recent-post-info"><a class="article-title" href="/post/996ec62b.html" title="Spring Security之OAuth2与微服务-案例实战(一)">Spring Security之OAuth2与微服务-案例实战(一)</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-31T09:54:26.000Z" title="发表于 2021-07-31 09:54:26">2021-07-31</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">案例实战：基于 Spring Security 和 Spring Cloud 构建微服务安全架构
设计一个案例系统，从零构建一个完整的微服务系统，演示微服务系统构建过程并展示 OAuth2 协议以及 JWT 在其中所起到的作用。
案例驱动：SpringAppointment
SpringAppointment 包含的业务场景比较简单，可以用来模拟就医过程中的预约处理流程。一般而言，预约流程势必会涉及三个独立的微服务，即就诊卡（Card）服务、预约（Appointment）服务，以及医生（Doctor）服务。
把以上三个服务统称为业务服务。纵观整个 SpringAppointment 系统，除了这三个业务微服务之外，还有一批非业务性的基础设施类服务，具体包括：注册中心服务（Eureka）、配置中心服务（Spring Cloud Config），以及 API 网关服务（Zuul）。
虽然案例中的各个服务在物理上都是独立的，但就整个系统而言，需要各服务相互协作构成一个完整的微服务系统。也就是说，服务运行时存在一定的依赖性。结合系统架构对 SpringAppointment 的运行方式进行梳理 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/2ce024a1.html" title="Spring Security之OAuth2与微服务-令牌拓展">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之OAuth2与微服务-令牌拓展"></a></div><div class="recent-post-info"><a class="article-title" href="/post/2ce024a1.html" title="Spring Security之OAuth2与微服务-令牌拓展">Spring Security之OAuth2与微服务-令牌拓展</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-30T12:54:26.000Z" title="发表于 2021-07-30 12:54:26">2021-07-30</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">令牌扩展：如何使用 JWT 实现定制化 Token？
事实上，在 OAuth2 协议中并没有明确规定 Token 具体的组成结构，而在现实应用中，不建议使用之前用到的 Token 格式，而是更倾向于采用 JWT。
什么是 JWT？
JWT 的全称是 JSON Web Token，所以它本质上是一种基于 JSON 表示的 Token。JWT 的设计目标就是为 OAuth2 协议中使用的 Token 提供一种标准结构，所以它经常与 OAuth2 协议集成在一起使用。
JWT 的基本结构
从结构上讲，JWT 本身由三段信息构成：第一段为头部（Header），第二段为有效负载（Payload），第三段为签名（Signature）。
1header. payload. signature
从数据格式上来看，以上三个部分的内容都是一个 JSON 对象。在 JWT 中，每一段 JSON 对象都用 Base64 进行编码，编码后的内容用“.”号连接一起，所以 JWT 本质上就是一个字符串。如下所示即为一个 JWT 字符串的示例：
1eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/post/1e1a6eb4.html" title="Spring Security之OAuth2与微服务-资源保护">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之OAuth2与微服务-资源保护"></a></div><div class="recent-post-info"><a class="article-title" href="/post/1e1a6eb4.html" title="Spring Security之OAuth2与微服务-资源保护">Spring Security之OAuth2与微服务-资源保护</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-30T10:35:26.000Z" title="发表于 2021-07-30 10:35:26">2021-07-30</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">资源保护：如何基于 OAuth2 协议配置授权过程？
关在日常开发过程中，需要对每个服务的不同功能进行不同粒度的权限控制，并且希望这种控制方法足够灵活，能够确保不同服务根据业务场景动态调整权限控制体系。同时，在微服务架构中，还需要考虑如何在多个服务中对 Token 进行有效的传播，确保整个服务访问的链路都得到授权管理。借助 Spring Security 框架，实现这些需求都很简单。
在微服务中集成 OAuth2 授权机制
在 OAuth2 协议中，单个微服务的定位就是资源服务器。Spring Security 框架为此提供了专门的 @EnableResourceServer 注解。通过在 Bootstrap 类中添加 @EnableResourceServer 注解，相当于声明该服务中的所有内容都是受保护的资源，示例代码如下所示：
12345678@SpringBootApplication@EnableResourceServerpublic class UserApplication &#123;  public static void main(String[] args) & ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/post/5b88b24b.html" title="Spring Security之OAuth2与微服务-授权体系">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Security之OAuth2与微服务-授权体系"></a></div><div class="recent-post-info"><a class="article-title" href="/post/5b88b24b.html" title="Spring Security之OAuth2与微服务-授权体系">Spring Security之OAuth2与微服务-授权体系</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-07-29T14:50:26.000Z" title="发表于 2021-07-29 14:50:26">2021-07-29</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spring/">Spring</a><i class="fas fa-angle-right"></i><a class="article-meta__categories" href="/categories/Spring/Spring-Security/">Spring Security</a></span></div><div class="content">授权体系：如何构建 OAuth2 授权服务器？
基于 Spring Security 框架，讨论如何构建授权服务器，并基于常用的密码模式生成对应的 Token。
构建 OAuth2 授权服务器
从表现形式上看，OAuth2 授权服务器也是一个独立的微服务，因此构建授权服务器的方法也是创建一个 Spring Boot 应用程序，需要引入对应的 Maven 依赖，如下所示：
12345678&lt;dependency&gt;    &lt;groupId&gt;org.springframework.security.oauth&lt;/groupId&gt;    &lt;artifactId&gt;spring-security-oauth2&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt;    &lt;groupId&gt;org.springframework.security.oauth.boot&lt;/groupId&gt;    &lt;artifactId&gt;spring-security-oauth2 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/31/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/#content-inner">31</a><span class="page-number current">32</span><a class="page-number" href="/page/33/#content-inner">33</a><span class="space">&hellip;</span><a class="page-number" href="/page/42/#content-inner">42</a><a class="extend next" rel="next" href="/page/33/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Leo Liu</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">416</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">91</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liule8"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/LIULE8" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:leo.liu.scau@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">这里是公告</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/0.html" title="无题"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/post/0.html" title="无题">无题</a><time datetime="2023-01-14T08:35:47.197Z" title="发表于 2023-01-14 08:35:47">2023-01-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/6ad73390.html" title="Java并发编程需要注意的问题"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java并发编程需要注意的问题"/></a><div class="content"><a class="title" href="/post/6ad73390.html" title="Java并发编程需要注意的问题">Java并发编程需要注意的问题</a><time datetime="2022-03-15T10:12:56.000Z" title="发表于 2022-03-15 10:12:56">2022-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/ede52282.html" title="ThreadLocal 学习笔记"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ThreadLocal 学习笔记"/></a><div class="content"><a class="title" href="/post/ede52282.html" title="ThreadLocal 学习笔记">ThreadLocal 学习笔记</a><time datetime="2022-02-11T14:13:31.000Z" title="发表于 2022-02-11 14:13:31">2022-02-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/69c3279c.html" title="Git"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git"/></a><div class="content"><a class="title" href="/post/69c3279c.html" title="Git">Git</a><time datetime="2022-01-24T09:17:45.000Z" title="发表于 2022-01-24 09:17:45">2022-01-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/fa358471.html" title="Java 反射"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java 反射"/></a><div class="content"><a class="title" href="/post/fa358471.html" title="Java 反射">Java 反射</a><time datetime="2022-01-13T13:54:26.000Z" title="发表于 2022-01-13 13:54:26">2022-01-13</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Git/"><span class="card-category-list-name">Git</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JDK/"><span class="card-category-list-name">JDK</span><span class="card-category-list-count">4</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JDK/JDK8/"><span class="card-category-list-name">JDK8</span><span class="card-category-list-count">4</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JVM/"><span class="card-category-list-name">JVM</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/"><span class="card-category-list-name">Java</span><span class="card-category-list-count">89</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><span class="card-category-list-name">多线程</span><span class="card-category-list-count">86</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Java-SE/"><span class="card-category-list-name">Java SE</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/JavaScript/"><span class="card-category-list-name">JavaScript</span><span class="card-category-list-count">3</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Spring/" style="font-size: 1.38em; color: rgb(48, 89, 94)">Spring</a><a href="/tags/JPA/" style="font-size: 1.15em; color: rgb(29, 95, 40)">JPA</a><a href="/tags/Spring-Data/" style="font-size: 1.31em; color: rgb(183, 37, 3)">Spring Data</a><a href="/tags/XML/" style="font-size: 1.17em; color: rgb(14, 159, 92)">XML</a><a href="/tags/Vue/" style="font-size: 1.17em; color: rgb(31, 32, 104)">Vue</a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" style="font-size: 1.15em; color: rgb(75, 115, 143)">面向对象设计原则</a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.17em; color: rgb(41, 34, 191)">架构</a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.4em; color: rgb(79, 195, 16)">算法</a><a href="/tags/UML/" style="font-size: 1.17em; color: rgb(73, 79, 50)">UML</a><a href="/tags/%E9%94%81/" style="font-size: 1.17em; color: rgb(180, 85, 117)">锁</a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.17em; color: rgb(91, 105, 154)">并发</a><a href="/tags/Git/" style="font-size: 1.15em; color: rgb(20, 169, 115)">Git</a><a href="/tags/%E6%B3%A8%E8%A7%A3/" style="font-size: 1.22em; color: rgb(120, 168, 137)">注解</a><a href="/tags/Spring-Data-Jpa/" style="font-size: 1.33em; color: rgb(102, 102, 76)">Spring Data Jpa</a><a href="/tags/JVM/" style="font-size: 1.24em; color: rgb(44, 74, 144)">JVM</a><a href="/tags/Java/" style="font-size: 1.45em; color: rgb(29, 71, 108)">Java</a><a href="/tags/CompletableFuture/" style="font-size: 1.15em; color: rgb(165, 99, 170)">CompletableFuture</a><a href="/tags/Future/" style="font-size: 1.15em; color: rgb(87, 106, 177)">Future</a><a href="/tags/%E5%8F%8D%E5%B0%84/" style="font-size: 1.15em; color: rgb(159, 145, 78)">反射</a><a href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/" style="font-size: 1.15em; color: rgb(198, 148, 91)">工具类</a><a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 1.15em; color: rgb(134, 198, 160)">集合</a><a href="/tags/lambda/" style="font-size: 1.2em; color: rgb(114, 9, 44)">lambda</a><a href="/tags/%E9%9B%86%E5%90%88%E7%B1%BB/" style="font-size: 1.15em; color: rgb(68, 69, 69)">集合类</a><a href="/tags/JavaScript/" style="font-size: 1.15em; color: rgb(64, 106, 85)">JavaScript</a><a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 1.43em; color: rgb(21, 120, 5)">并发编程</a><a href="/tags/%E7%BA%BF%E7%A8%8B/" style="font-size: 1.43em; color: rgb(24, 125, 46)">线程</a><a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 1.2em; color: rgb(16, 169, 44)">框架</a><a href="/tags/MySQL/" style="font-size: 1.29em; color: rgb(90, 16, 4)">MySQL</a><a href="/tags/I-O%E6%A8%A1%E5%9E%8B/" style="font-size: 1.36em; color: rgb(53, 59, 166)">I\O模型</a><a href="/tags/Netty/" style="font-size: 1.36em; color: rgb(182, 5, 15)">Netty</a><a href="/tags/Socket%E7%BC%96%E7%A8%8B/" style="font-size: 1.36em; color: rgb(89, 196, 141)">Socket编程</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.17em; color: rgb(65, 69, 200)">数据库</a><a href="/tags/Oracle/" style="font-size: 1.17em; color: rgb(171, 165, 66)">Oracle</a><a href="/tags/SQL/" style="font-size: 1.2em; color: rgb(178, 28, 186)">SQL</a><a href="/tags/pageable/" style="font-size: 1.15em; color: rgb(98, 8, 12)">pageable</a><a href="/tags/RestTemplate/" style="font-size: 1.15em; color: rgb(25, 166, 40)">RestTemplate</a><a href="/tags/String/" style="font-size: 1.27em; color: rgb(47, 59, 71)">String</a><a href="/tags/Springboot/" style="font-size: 1.2em; color: rgb(25, 130, 34)">Springboot</a><a href="/tags/Annotation/" style="font-size: 1.17em; color: rgb(54, 159, 136)">Annotation</a><a href="/tags/JpaSpecificationExecutor/" style="font-size: 1.2em; color: rgb(47, 181, 121)">JpaSpecificationExecutor</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/03/"><span class="card-archive-list-date">三月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/12/"><span class="card-archive-list-date">十二月 2021</span><span class="card-archive-list-count">24</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/11/"><span class="card-archive-list-date">十一月 2021</span><span class="card-archive-list-count">53</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/10/"><span class="card-archive-list-date">十月 2021</span><span class="card-archive-list-count">105</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/09/"><span class="card-archive-list-date">九月 2021</span><span class="card-archive-list-count">106</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">416</div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">1330.9k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-01-14T08:37:16.465Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Leo Liu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><br/>
<img style="vertical-align: middle; padding-bottom: 5px;" src="https://haiyong.site/img/icp.png">
<a href="https://beian.miit.gov.cn/#/Integrated/index"  style="color:white" target="_blank">粤ICP备20009586号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function subtitleType () {
  fetch('https://api.btstu.cn/yan/api.php?charset=utf-8&encode=json')
    .then(response => response.json())
    .then(data => {
      if (true) {
        var sub = "".length == 0 ? new Array() : "".split(',')
        var both = sub.unshift(data.text)
        typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = data.text
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>